<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Troop - Transporte Seguro e Confiável</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&family=Audiowide&display=swap" rel="stylesheet">
    
    <!-- Custom Styles & Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'troop-purple': '#322275',
                        'troop-light-gray': '#F5F5F5',
                        'troop-dark-gray': '#333333',
                        'troop-white': '#FFFFFF',
                        'muted': '#E5E7EB',
                        'muted-foreground': '#6B7280',
                    },
                    fontFamily: {
                        'lato': ['Lato', 'sans-serif'],
                        'horizon': ['Audiowide', 'cursive'],
                    },
                    boxShadow: {
                        'strong': '0 10px 25px -5px rgba(0, 0, 0, 0.2), 0 8px 10px -6px rgba(0, 0, 0, 0.2)',
                    },
                    height: {
                        '128': '32rem', // 512px
                    }
                }
            }
        }
    </script>
    <style>
        .bg-gradient-overlay {
            /* Overlay com transparência ajustada para tornar a imagem mais visível */
            background-image: linear-gradient(to top, rgba(50, 34, 117, 0.75) 0%, rgba(50, 34, 117, 0.3) 60%, rgba(50, 34, 117, 0.1) 100%);
        }
        /* For date input placeholder */
        <!DOCTYPE html>
        <html lang="pt-BR">
          <head>
            <meta charset="utf-8" />
            <meta name="viewport" content="width=device-width, initial-scale=1" />
            <title>Troop — Redirect</title>
            <meta http-equiv="refresh" content="0; url=/index.html" />
            <style>
              body { font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; display:flex; align-items:center; justify-content:center; height:100vh; margin:0; background:#f8fafc }
              .card { background:#fff; padding:24px; border-radius:8px; box-shadow:0 8px 24px rgba(0,0,0,0.08); text-align:center }
              a { color:#322275; font-weight:600 }
            </style>
          </head>
          <body>
            <div class="card">
              <h1>Redirecionando para a página principal</h1>
              <p>Você será redirecionado em instantes. Caso não, clique <a href="/index.html">aqui</a>.</p>
            </div>
          </body>
        </html>
                        <ul class="space-y-3 text-troop-dark-gray my-8 flex-grow">
                            <li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>Todas as viagens da semana</li>
                            <li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>Suporte prioritário</li>
                            <li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>Seguro premium</li>
                            <li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>Desconto de 30%</li>
                            <li class="flex items-center"><svg class="w-5 h-5 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>Flexibilidade de horários</li>
                        </ul>
                        <a href="#" class="selecionar-plano w-full text-center bg-troop-purple/10 text-troop-purple font-bold py-3 px-4 rounded-lg hover:bg-troop-purple/20 transition-colors">Selecionar</a>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-troop-dark-gray text-troop-white">
        <div class="container mx-auto px-6 py-12">
            <div class="grid md:grid-cols-3 gap-8 text-center md:text-left">
                <div class="flex flex-col items-center md:items-start">
                    <div class="flex items-center space-x-3 mb-4">
    <script>
document.addEventListener("DOMContentLoaded", function () {
    // Dados dos motoristas por rota (removido um motorista e adicionados lugares fictícios das escolas)
    const motoristasPorRota = [
        {
            rota: "Escola de Inglês",
            cor: "#2563eb",
            origem: { lat: -31.7654, lng: -52.3371 },
            destino: { lat: -31.7800, lng: -52.3400 }, // Escola de Inglês fictícia
            motoristas: [
                { nome: "João Silva", foto: "https://randomuser.me/api/portraits/men/32.jpg", veiculo: "Van Sprinter", placa: "ABC-1234" }
            ]
        },
        {
            rota: "Show (Evento)",
            cor: "#22c55e",
            origem: { lat: -31.7654, lng: -52.3371 },
            destino: { lat: -31.7500, lng: -52.3200 }, // Show (Evento) fictícia
            motoristas: [
                { nome: "Carlos Lima", foto: "https://randomuser.me/api/portraits/men/65.jpg", veiculo: "Van Boxer", placa: "JKL-4321" }
            ]
        },
        {
            rota: "SENAC",
            cor: "#a21caf",
            origem: { lat: -31.7616, lng: -52.3867 },
            destino: { lat: -31.77019, lng: -52.34177 }, // SENAC fictício (será sobrescrito)
            motoristas: [
                { nome: "Fernanda Alves", foto: "https://randomuser.me/api/portraits/women/50.jpg", veiculo: "Van Renault Master", placa: "SEN-2025" }
            ]
        }
    ];

    let partidaCoords = null;
    let map, marker, directionsService, directionsRenderer, polylines = [];

    // Google Places Autocomplete para o campo de partida
    const partidaInput = document.getElementById('partida');
    let autocomplete = new google.maps.places.Autocomplete(partidaInput, {
        types: ['address'], // Permite endereços completos incluindo nomes de ruas
        componentRestrictions: { country: 'br' }
    });
    autocomplete.addListener('place_changed', function () {
        const place = autocomplete.getPlace();
        if (!place.geometry) return;
        partidaCoords = {
            lat: place.geometry.location.lat(),
            lng: place.geometry.location.lng()
        };

        // Mostra o endereço completo selecionado no campo de partida
        partidaInput.value = place.formatted_address;

        // Remove qualquer extração manual do bairro!
        let bairroDiv = document.getElementById('bairro-partida');
        if (bairroDiv) bairroDiv.remove();

        // Atualiza as origens das vans para ficarem próximas ao endereço de partida
        motoristasPorRota.forEach((rotaObj, idx) => {
            const offset = 0.003 + idx * 0.0015;
            rotaObj.origem = {
                lat: partidaCoords.lat + (Math.random() - 0.5) * offset,
                lng: partidaCoords.lng + (Math.random() - 0.5) * offset
            };
        });

        // Se o mapa já foi inicializado, recentra no novo endereço com zoom ideal para o círculo de 1km
        if (map) {
            map.setCenter(partidaCoords);
            map.setZoom(14); // Zoom ideal para visualizar círculo de 1km
        }
    });

    // Antes de renderMotoristas e inicializarMapaERotas, defina bairros fictícios:
    const bairrosFicticios = [
        { nome: "Centro", lat: -31.7654, lng: -52.3371 },
        { nome: "Fragata", lat: -31.7700, lng: -52.3400 },
        { nome: "Três Vendas", lat: -31.7500, lng: -52.3200 },
        { nome: "Areal", lat: -31.7550, lng: -52.3500 }
    ];

    // Renderiza os cards de motoristas
    function renderMotoristas() {
        const cardsContainer = document.getElementById('motoristas-cards');
        cardsContainer.innerHTML = "";

        // Se não foi selecionado endereço de partida e escola, mostra todas as rotas saindo de bairros diferentes
        let origemCustomizada = false;
        if (!partidaCoords || !document.getElementById('destino').value) {
            motoristasPorRota.forEach((rotaObj, idx) => {
                rotaObj.origem = {
                    lat: bairrosFicticios[idx % bairrosFicticios.length].lat,
                    lng: bairrosFicticios[idx % bairrosFicticios.length].lng
                };
            });
            origemCustomizada = true;
        } else {
            // Distribui as vans em pontos distintos dentro do raio de 3km
            const raioKm = 3;
            const raioGraus = raioKm / 111; // Aproximadamente 1 grau = 111km
            
            motoristasPorRota.forEach((rotaObj, idx) => {
                // Calcula ângulos distintos para cada van (distribui uniformemente)
                const angulo = (idx * (360 / motoristasPorRota.length)) * (Math.PI / 180);
                // Varia a distância para criar mais diversidade
                const distancia = raioGraus * (0.3 + (idx % 3) * 0.35); // Entre 30% e 95% do raio
                
                rotaObj.origem = {
                    lat: partidaCoords.lat + Math.cos(angulo) * distancia,
                    lng: partidaCoords.lng + Math.sin(angulo) * distancia
                };
            });
            origemCustomizada = true;
        }

        motoristasPorRota.forEach((rotaObj, idx) => {
            rotaObj.motoristas.forEach((motorista, mIdx) => {
                // Horários diferentes: manhã, tarde, noite
                const horariosPossiveis = ["07:00 (Manhã)", "14:00 (Tarde)", "19:00 (Noite)"];
                const horario = horariosPossiveis[idx % horariosPossiveis.length];

                // Pontos de parada reais (usados no mapa)
                let paradas = [];
                if (rotaObj.rota === "Escola de Inglês") {
                    paradas.push({ nome: "Escola de Inglês", cor: rotaObj.cor });
                    if (mIdx === 0) paradas.push({ nome: "Show (Evento)", cor: "#22c55e" });
                }
                if (rotaObj.rota === "Show (Evento)") paradas.push({ nome: "Show (Evento)", cor: rotaObj.cor });

                // Detalhe do trajeto: mostra bolinhas coloridas dos pontos de parada
                let trajeto = `Origem`;
                if (paradas.length > 0) {
                    trajeto += " ";
                    trajeto += paradas.map(escola =>
                        `<span class="inline-block align-middle mr-1">
                            <span class="h-2 w-2 rounded-full inline-block mr-1" style="background:${escola.cor};border:1.5px solid #333"></span>
                            <span>${escola.nome}</span>
                        </span>`
                    ).join(" ");
                    trajeto += " - SENAC";
                } else {
                    trajeto += " - SENAC";
                }

                const card = document.createElement('div');
                card.className = "bg-troop-white rounded-xl shadow-lg p-6 flex flex-col items-center";
                card.innerHTML = `
                    <div class="flex items-center mb-2">
                        <span class="inline-block h-3 w-3 rounded-full mr-2" style="background:${rotaObj.cor}"></span>
                        <span class="font-bold text-lg">${motorista.nome}</span>
                    </div>
                    <div class="flex items-center mb-2">
                        <img src="${motorista.foto}" alt="${motorista.nome}" class="h-12 w-12 rounded-full object-cover mr-4" style="border-color:${rotaObj.cor};border-width:2px;border-style:solid;">
                        <div class="flex-1 text-left">
                            <div class="font-semibold">${motorista.veiculo} • ${motorista.placa}</div>
                            <div class="text-xs text-muted-foreground">${trajeto}</div>
                            <div class="text-xs text-troop-purple font-bold mt-1">Horário: ${horario}</div>
                        </div>
                    </div>
                    <button class="motorista-card w-full bg-troop-purple text-troop-white font-bold py-2 px-4 rounded-lg mt-2 hover:bg-troop-purple/90 transition-colors"
                        data-rota="${rotaObj.rota}" data-idx="${idx}" data-motorista="${mIdx}">
                        Selecionar
                    </button>
                `;
                cardsContainer.appendChild(card);
            });
        });
    }

    // Cada motorista tem sua rota traçada no mapa ao clicar
    function inicializarMapaERotas() {
        // Define o centro do mapa baseado no endereço de partida se disponível
        const mapCenter = partidaCoords || { lat: -31.7654, lng: -52.3371 };
        const mapZoom = partidaCoords ? 14 : 12; // Zoom ideal para ver círculo de 1km se há endereço selecionado
        
        map = new google.maps.Map(document.getElementById("map"), {
            center: mapCenter,
            zoom: mapZoom,
        });
        directionsService = new google.maps.DirectionsService();

        // Adiciona círculo de 1km de raio ao redor do endereço de partida
        if (partidaCoords) {
            const circle = new google.maps.Circle({
                strokeColor: '#322275',
                strokeOpacity: 0.8,
                strokeWeight: 2,
                fillColor: '#322275',
                fillOpacity: 0.1,
                map: map,
                center: partidaCoords,
                radius: 1000 // 1km em metros
            });
            
            // Ajusta o zoom e centro do mapa para mostrar perfeitamente o círculo de 1km
            const bounds = circle.getBounds();
            map.fitBounds(bounds);
            
            // Força um zoom específico que seja ideal para visualizar 1km de raio
            setTimeout(() => {
                map.setZoom(14);
            }, 100);
            
            // Adiciona marcador no centro (endereço de partida)
            new google.maps.Marker({
                position: partidaCoords,
                map: map,
                title: "Seu endereço de partida",
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 10,
                    fillColor: '#322275',
                    fillOpacity: 1,
                    strokeColor: '#FFFFFF',
                    strokeWeight: 3
                }
            });
        }

        let routeRenderers = [];
        const enderecoSenac = "Rua Gonçalves Chaves, 604, Pelotas, RS";

        // Coordenadas fictícias das escolas
        const escolasCoords = {
            "Escola de Inglês": { lat: -31.7800, lng: -52.3400 },
            "Show (Evento)": { lat: -31.7500, lng: -52.3200 }
        };

        // Se não foi selecionado endereço de partida e escola, mostra todas as rotas saindo de bairros diferentes
        if (!partidaCoords || !document.getElementById('destino').value) {
            motoristasPorRota.forEach((rotaObj, idx) => {
                rotaObj.origem = {
                    lat: bairrosFicticios[idx % bairrosFicticios.length].lat,
                    lng: bairrosFicticios[idx % bairrosFicticios.length].lng
                };
            });
        } else {
            // Distribui as vans em pontos distintos dentro do raio de 1km
            const raioKm = 1;
            const raioGraus = raioKm / 111; // Aproximadamente 1 grau = 111km
            
            motoristasPorRota.forEach((rotaObj, idx) => {
                // Calcula ângulos distintos para cada van (distribui uniformemente)
                const angulo = (idx * (360 / motoristasPorRota.length)) * (Math.PI / 180);
                // Varia a distância para criar mais diversidade
                const distancia = raioGraus * (0.3 + (idx % 3) * 0.35); // Entre 30% e 95% do raio
                
                rotaObj.origem = {
                    lat: partidaCoords.lat + Math.cos(angulo) * distancia,
                    lng: partidaCoords.lng + Math.sin(angulo) * distancia
                };
            });
        }

        motoristasPorRota.forEach((rotaObj, idx) => {
            rotaObj.motoristas.forEach((motorista, mIdx) => {
                let destinoFinal = enderecoSenac;
                let waypoints = [];

                // Motorista da Escola de Inglês faz Origem -> Escola de Inglês -> SENAC
                if (rotaObj.rota === "Escola de Inglês") {
                    waypoints.push({
                        location: escolasCoords["Escola de Inglês"],
                        stopover: true
                    });
                }
                // Motorista do Show (Evento) faz Origem -> Show (Evento) -> SENAC
                if (rotaObj.rota === "Show (Evento)") {
                    waypoints.push({
                        location: escolasCoords["Show (Evento)"],
                        stopover: true
                    });
                }
                // Exemplo extra: motorista da Escola A também passa pela Escola B antes do SENAC
                if (rotaObj.rota === "Escola A" && mIdx === 0) {
                    waypoints.push({
                        location: escolasCoords["Escola B"],
                        stopover: true
                    });
                }

                const renderer = new google.maps.DirectionsRenderer({
                    map: map,
                    suppressMarkers: true,
                    polylineOptions: {
                        strokeColor: rotaObj.cor,
                        strokeOpacity: 0.9,
                        strokeWeight: 6
                    }
                });
                routeRenderers.push(renderer);

                // Adiciona marcador na origem da van
                new google.maps.Marker({
                    position: rotaObj.origem,
                    map: map,
                    title: `Van de ${motorista.nome} - ${rotaObj.rota}`,
                    icon: {
                        path: google.maps.SymbolPath.BACKWARD_CLOSED_ARROW,
                        scale: 6,
                        fillColor: rotaObj.cor,
                        fillOpacity: 1,
                        strokeColor: '#FFFFFF',
                        strokeWeight: 2
                    }
                });

                directionsService.route({
                    origin: rotaObj.origem,
                    destination: destinoFinal,
                    waypoints: waypoints,
                    travelMode: google.maps.TravelMode.DRIVING
                }, function(response, status) {
                    if (status === google.maps.DirectionsStatus.OK) {
                        renderer.setDirections(response);
                        motorista.directions = response;
                        motorista.renderer = renderer;

                        // Adiciona marcadores para cada parada (waypoint)
                        waypoints.forEach((wp, i) => {
                            // Determina o nome da parada baseado nas coordenadas
                            let nomeParada = 'Escola';
                            for (const [nome, coords] of Object.entries(escolasCoords)) {
                                if (Math.abs(coords.lat - wp.location.lat) < 0.001 && 
                                    Math.abs(coords.lng - wp.location.lng) < 0.001) {
                                    nomeParada = nome;
                                    break;
                                }
                            }
                            
                            new google.maps.Marker({
                                position: wp.location,
                                map: map,
                                icon: {
                                    path: google.maps.SymbolPath.CIRCLE,
                                    scale: 12,
                                    fillColor: rotaObj.cor,
                                    fillOpacity: 0.9,
                                    strokeColor: "#FFFFFF",
                                    strokeWeight: 3
                                },
                                title: `Parada: ${nomeParada}`,
                                label: {
                                    text: String(i + 1),
                                    color: '#FFFFFF',
                                    fontSize: '12px',
                                    fontWeight: 'bold'
                                }
                            });
                            
                            // Adiciona InfoWindow com informações da parada
                            const infoWindow = new google.maps.InfoWindow({
                                content: `
                                    <div style="padding: 8px;">
                                        <h3 style="margin: 0; color: ${rotaObj.cor}; font-weight: bold;">${nomeParada}</h3>
                                        <p style="margin: 4px 0; font-size: 12px;">Parada ${i + 1} da rota</p>
                                        <p style="margin: 4px 0; font-size: 12px;">Motorista: ${motorista.nome}</p>
                                        <p style="margin: 4px 0; font-size: 12px;">Veículo: ${motorista.veiculo}</p>
                                    </div>
                                `
                            });
                            
                            // Cria o marcador da parada
                            const paradaMarker = new google.maps.Marker({
                                position: wp.location,
                                map: map,
                                icon: {
                                    path: google.maps.SymbolPath.CIRCLE,
                                    scale: 12,
                                    fillColor: rotaObj.cor,
                                    fillOpacity: 0.9,
                                    strokeColor: "#FFFFFF",
                                    strokeWeight: 3
                                },
                                title: `Parada: ${nomeParada}`,
                                label: {
                                    text: String(i + 1),
                                    color: '#FFFFFF',
                                    fontSize: '12px',
                                    fontWeight: 'bold'
                                }
                            });
                            
                            // Adiciona evento de clique para mostrar InfoWindow
                            paradaMarker.addListener('click', function() {
                                infoWindow.open(map, paradaMarker);
                            });
                        });
                    }
                });

                // Marcador de destino SENAC (apenas uma vez)
                if (idx === 0 && mIdx === 0) {
                    const geocoder = new google.maps.Geocoder();
                    geocoder.geocode({ address: enderecoSenac }, function(results, status) {
                        if (status === "OK" && results[0]) {
                            const senacMarker = new google.maps.Marker({
                                position: results[0].geometry.location,
                                map: map,
                                icon: {
                                    path: google.maps.SymbolPath.CIRCLE,
                                    scale: 15,
                                    fillColor: '#ff6b35',
                                    fillOpacity: 1,
                                    strokeColor: '#FFFFFF',
                                    strokeWeight: 3
                                },
                                title: "Destino Final: SENAC",
                                label: {
                                    text: 'D',
                                    color: '#FFFFFF',
                                    fontSize: '14px',
                                    fontWeight: 'bold'
                                }
                            });
                            
                            // InfoWindow para o destino SENAC
                            const senacInfoWindow = new google.maps.InfoWindow({
                                content: `
                                    <div style="padding: 8px;">
                                        <h3 style="margin: 0; color: #ff6b35; font-weight: bold;">SENAC</h3>
                                        <p style="margin: 4px 0; font-size: 12px;">Destino Final</p>
                                        <p style="margin: 4px 0; font-size: 12px;">Todas as rotas chegam aqui</p>
                                        <p style="margin: 4px 0; font-size: 10px; color: #666;">${enderecoSenac}</p>
                                    </div>
                                `
                            });
                            
                            // Evento de clique para mostrar InfoWindow do SENAC
                            senacMarker.addListener('click', function() {
                                senacInfoWindow.open(map, senacMarker);
                            });
                        }
                    });
                }
            });
        });

        // Legenda das vans
        adicionarLegendaVans();

        // Ao clicar no botão do motorista, mostra só a rota dele
        document.querySelectorAll('.motorista-card').forEach((btn) => {
            btn.addEventListener('click', function() {
                routeRenderers.forEach(r => r.setMap(null));
                const idx = parseInt(this.getAttribute('data-idx'));
                const mIdx = parseInt(this.getAttribute('data-motorista'));
                const motorista = motoristasPorRota[idx].motoristas[mIdx];
                if (motorista.renderer) {
                    motorista.renderer.setMap(map);
                }
                document.getElementById('etapa-2').classList.add('hidden');
                document.getElementById('planos').classList.remove('hidden');
                document.getElementById('planos').scrollIntoView({behavior: "smooth"});
            });
        });
    }

    // Adiciona legenda das vans no mapa
    function adicionarLegendaVans() {
        // Remove legenda anterior se existir
        const oldLegend = document.getElementById('map-legend');
        if (oldLegend) oldLegend.remove();

        const legend = document.createElement('div');
        legend.id = 'map-legend';
        legend.className = 'absolute bottom-6 left-6 bg-white/90 rounded-xl shadow-lg p-4 text-left z-50';
        legend.style.maxWidth = '320px';

        legend.innerHTML = `
            <div class="font-bold mb-2 text-troop-dark-gray">Legenda das Vans</div>
            ${motoristasPorRota.map((rotaObj, idx) => `
                <div class="flex items-center mb-1">
                    <span class="inline-block h-4 w-4 rounded-full mr-2" style="background:${rotaObj.cor}"></span>
                    <span class="font-semibold">${rotaObj.motoristas.map(m => m.nome).join(', ')}</span>
                </div>
            `).join('')}
        `;
        // Adiciona legenda dentro do container do mapa
        document.querySelector('.relative.rounded-xl.overflow-hidden.shadow-lg.h-96').appendChild(legend);
    }

    // Botão de buscar rotas - agora consulta o backend via `troopApi.fetchRoutes`
    document.getElementById('btn-etapa-1').onclick = async function(e) {
        e.preventDefault();
        const origin = document.getElementById('partida').value || '';
        const destination = document.getElementById('destino').value || '';
        const date = document.getElementById('data').value || '';

        try {
            // fetchRoutes retorna objeto JSON (ex: { routes: [...] }) ou array
            const resp = await (window.troopApi ? window.troopApi.fetchRoutes({ origin, destination, date }) : Promise.reject(new Error('API helper não carregado')));
            let routesList = [];
            if (Array.isArray(resp)) routesList = resp;
            else if (resp.routes) routesList = resp.routes;

            // Mapear rotas do backend para o formato esperado pelo frontend (motoristasPorRota)
            // esqueleto: { rota, cor, origem: {lat,lng}, destino: {lat,lng}, motoristas: [{nome,foto,veiculo,placa}] }
            const colors = ['#2563eb','#22c55e','#a21caf','#ff7f50','#f59e0b'];
            // Limpa array existente e popula com novos itens
            motoristasPorRota.length = 0;
            routesList.forEach((r, i) => {
                motoristasPorRota.push({
                    rota: r.destination || r.destination,
                    cor: colors[i % colors.length],
                    origem: { lat: (r.originLat || r.origin?.lat) || -31.7654, lng: (r.originLng || r.origin?.lng) || -52.3371 },
                    destino: { lat: (r.destinationLat || r.destination?.lat) || -31.7800, lng: (r.destinationLng || r.destination?.lng) || -52.3400 },
                    motoristas: [ { nome: r.driver?.name || `Motorista ${i+1}`, foto: 'https://randomuser.me/api/portraits/lego/1.jpg', veiculo: r.vehicle || 'Van', placa: r.id ? `R${r.id}` : '---' } ]
                });
            });
        } catch (err) {
            console.error('Erro ao buscar rotas:', err);
            // Mantém a UI funcional com dados fictícios, mas avisa o usuário
            alert('Não foi possível buscar rotas do servidor. Mostrando resultados locais.');
        }

        document.getElementById('etapa-1').classList.add('hidden');
        document.getElementById('etapa-2').classList.remove('hidden');
        renderMotoristas();
        inicializarMapaERotas();
    };

    // Botão selecionar plano
    document.querySelectorAll('.selecionar-plano').forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.preventDefault();
            window.location.href = "login.html";
        });
    });
});
</script>
    <!-- Troop frontend scripts -->
    <script src="js/api.js"></script>
    <script src="js/app.js"></script>
</body>
</html>